<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="../assets/css/reset.css" />
    <link rel="stylesheet" href="../assets/css/style.css" />
    <link rel="stylesheet" href="../assets/css/style-dashboard.css" />
    <link rel="stylesheet" href="../assets/css/style-container-Individual.css">
    <link rel="shortcut icon" href="../assets/img/oceanides-logo.png"/>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>Dashboard - Containers</title>
  </head>
  <body onload="validarSessao(), verificarAdm(), obterDadosContainer()">
    <div id="dashboard">
      <div id="menu-aberto" class="menu animate__animated">
        <div id="menu-botao-infos">
          <div onclick="abrirFecharMenu()" class="icone-botao">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
              <path
                d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"
              />
            </svg>
          </div>
          <div class="infos-usuario">
            <span id="span_nome"></span>
            <span id="span_empresa"></span>
            <span id="span_nivel"></span>
          </div>
        </div>

        <div id="tabs">
          <div id="itens">
            <a href="home.html">
              <div class="item">
                <div class="icone-botao">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                    <path
                      d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"
                    />
                  </svg>
                </div>
                <p class="texto-item">home</p>
              </div>
            </a>

            <a href="containers.html">
              <div class="item ativo">
                <div class="icone-botao">
                  <svg
                    width="24"
                    height="18"
                    viewBox="0 0 24 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    style="width: 25px; display: block; height: 25px"
                  >
                    <path
                      d="M1.2 0.899902C0.53625 0.899902 0 1.43615 0 2.0999C0 2.76365 0.53625 3.2999 1.2 3.2999V15.2999C0.53625 15.2999 0 15.8362 0 16.4999C0 17.1637 0.53625 17.6999 1.2 17.6999H22.8C23.4638 17.6999 24 17.1637 24 16.4999C24 15.8362 23.4638 15.2999 22.8 15.2999V3.2999C23.4638 3.2999 24 2.76365 24 2.0999C24 1.43615 23.4638 0.899902 22.8 0.899902H1.2ZM6.6 5.3999V13.1999C6.6 13.6987 6.19875 14.0999 5.7 14.0999C5.20125 14.0999 4.8 13.6987 4.8 13.1999V5.3999C4.8 4.90115 5.20125 4.4999 5.7 4.4999C6.19875 4.4999 6.6 4.90115 6.6 5.3999ZM10.8 5.3999V13.1999C10.8 13.6987 10.3988 14.0999 9.9 14.0999C9.40125 14.0999 9 13.6987 9 13.1999V5.3999C9 4.90115 9.40125 4.4999 9.9 4.4999C10.3988 4.4999 10.8 4.90115 10.8 5.3999ZM15 5.3999V13.1999C15 13.6987 14.5988 14.0999 14.1 14.0999C13.6013 14.0999 13.2 13.6987 13.2 13.1999V5.3999C13.2 4.90115 13.6013 4.4999 14.1 4.4999C14.5988 4.4999 15 4.90115 15 5.3999ZM19.2 5.3999V13.1999C19.2 13.6987 18.7987 14.0999 18.3 14.0999C17.8013 14.0999 17.4 13.6987 17.4 13.1999V5.3999C17.4 4.90115 17.8013 4.4999 18.3 4.4999C18.7987 4.4999 19.2 4.90115 19.2 5.3999Z"
                      fill="#00afef"
                    />
                  </svg>
                </div>
                <p class="texto-item">containers</p>
              </div>
            </a>
           
          </div>

          <div onclick="window.location.href = '../../index.html'" class="botao-sair">
            <div class="icone-botao">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                <path
                  d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
                />
              </svg>
            </div>
            <p class="texto-item">sair</p>
          </div>
        </div>
      </div>

      <div id="menu-fechado" class="menu animate__animated">
        <div id="menu-botao-infos">
          <div onclick="abrirFecharMenu()" class="icone-botao fechado">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
              <path
                d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"
              />
            </svg>
          </div>
        </div>

        <div id="tabs">
          <div id="itens_fechados">
            <a href="home.html">
              <div class="item">
                <div class="icone-botao">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                    <path
                      d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"
                    />
                  </svg>
                </div>
              </div>
            </a>

            <a href="cargueiros.html">
              <div class="item">
                <div class="icone-botao">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                    <path
                      d="M320 96a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zm21.1 80C367 158.8 384 129.4 384 96c0-53-43-96-96-96s-96 43-96 96c0 33.4 17 62.8 42.9 80H224c-17.7 0-32 14.3-32 32s14.3 32 32 32h32V448H208c-53 0-96-43-96-96v-6.1l7 7c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9L97 263c-9.4-9.4-24.6-9.4-33.9 0L7 319c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l7-7V352c0 88.4 71.6 160 160 160h80 80c88.4 0 160-71.6 160-160v-6.1l7 7c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-56-56c-9.4-9.4-24.6-9.4-33.9 0l-56 56c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l7-7V352c0 53-43 96-96 96H320V240h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H341.1z"
                    />
                  </svg>
                </div>
              </div>
            </a>

            <a href="containers.html">
              <div class="item ativo">
                <div class="icone-botao">
                  <svg
                    width="24"
                    height="18"
                    viewBox="0 0 24 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    style="width: 25px; display: block; height: 25px"
                  >
                    <path
                      d="M1.2 0.899902C0.53625 0.899902 0 1.43615 0 2.0999C0 2.76365 0.53625 3.2999 1.2 3.2999V15.2999C0.53625 15.2999 0 15.8362 0 16.4999C0 17.1637 0.53625 17.6999 1.2 17.6999H22.8C23.4638 17.6999 24 17.1637 24 16.4999C24 15.8362 23.4638 15.2999 22.8 15.2999V3.2999C23.4638 3.2999 24 2.76365 24 2.0999C24 1.43615 23.4638 0.899902 22.8 0.899902H1.2ZM6.6 5.3999V13.1999C6.6 13.6987 6.19875 14.0999 5.7 14.0999C5.20125 14.0999 4.8 13.6987 4.8 13.1999V5.3999C4.8 4.90115 5.20125 4.4999 5.7 4.4999C6.19875 4.4999 6.6 4.90115 6.6 5.3999ZM10.8 5.3999V13.1999C10.8 13.6987 10.3988 14.0999 9.9 14.0999C9.40125 14.0999 9 13.6987 9 13.1999V5.3999C9 4.90115 9.40125 4.4999 9.9 4.4999C10.3988 4.4999 10.8 4.90115 10.8 5.3999ZM15 5.3999V13.1999C15 13.6987 14.5988 14.0999 14.1 14.0999C13.6013 14.0999 13.2 13.6987 13.2 13.1999V5.3999C13.2 4.90115 13.6013 4.4999 14.1 4.4999C14.5988 4.4999 15 4.90115 15 5.3999ZM19.2 5.3999V13.1999C19.2 13.6987 18.7987 14.0999 18.3 14.0999C17.8013 14.0999 17.4 13.6987 17.4 13.1999V5.3999C17.4 4.90115 17.8013 4.4999 18.3 4.4999C18.7987 4.4999 19.2 4.90115 19.2 5.3999Z"
                      fill="#00afef"
                    />
                  </svg>
                </div>
              </div>
            </a>
            
          </div>

          <div class="botao-sair">
            <div onclick="window.location.href = '../../index.html'" class="icone-botao">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                <path
                  d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
                />
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div id="conteudo" class="conteudo">
        <div class="informacoes-container">
          <h1 class="titulo-container">Container Banana | CON-9837453</h1>
          <div class="status-container">
            <p id="p_umidade"> Umidade:  </p>
            <p id="p_temperatura">  Temperatura:  </p>
            <p>Destino: França</p>
            <p>IMO cargueiro: CARG-202304</p>
          </div>
        </div>
        
        <div class="alertas-graficos">
          <div class="alertas">
            <h1 class="titulo-alertas">Alertas</h1>
            <div id="div_alerta1" class="alerta-modelo alerta1">
              <p>Critico</p>
              <p> 10.00°C |  90,00%</p>
            </div>
            <div id="div_alerta2" class="alerta-modelo alerta2">
              <p>Alerta</p>
              <p>11.64°C | 90,45%</p>
            </div>  
            <div id="div_alerta3" class="alerta-modelo alerta3">
              <p>Ideal</p>
              <p>11.65°C | 90,46%</p>
            </div>
            <div id="div_alerta4" class="alerta-modelo alerta4">
              <p>Alerta</p>
              <p>13.05°C | 91,34%</p>
            </div>
            <div id="div_alerta5" class="alerta-modelo alerta5">
              <p> Critico</p>
              <p>14.00°C | 95,00%</p>
            </div>
          </div>
        

            <div class="graficos">

                <div class="grafico-individual">
                   
                    <section style="width:100%; height: 100%;">
                        <canvas id="dht11Umidade"></canvas>
                    </section>
                </div>
                <div class="grafico-individual">
                   
                    <section style="width:100%; height: 100%;">
                        <canvas id="dht11Temperatura"></canvas>
                    </section>
                </div>
               
            </div>
       
      </div>

    </div>
  </body>
</html>
<script src="../assets/js/dashboard-menu.js"></script>
<script src="../assets/js/funções.js"></script>
<script src="../assets/js/dashboard-container-individual.js"></script>
<script>
  var tempAtual;
  var umidadeAtual;
    /* -- dht11Umidade -- */
    var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
    contextoDht11Umidade.canvas.width = 1000;
    contextoDht11Umidade.canvas.height = 300;
    var dht11Umidade = new Chart(
        contextoDht11Umidade,
        {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Umidade',
                    type: 'line',
                    borderColor: ['#45b3e7'],
                    backgroundColor: ['#89cff0']
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        distribution: 'series',
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Umidade'
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                animation: {
                    duration: 0
                }
            }
        }
    );
    /* -- dht11Temperatura -- */
    var contextoDht11Temperatura = document.getElementById('dht11Temperatura').getContext('2d');
    contextoDht11Temperatura.canvas.width = 1000;
    contextoDht11Temperatura.canvas.height = 300;
    var dht11Temperatura = new Chart(
        contextoDht11Temperatura,
        {
            type: 'line',
            data: {
                datasets: [{
                    label: "Temperatura",
                    type: 'line',
                    borderColor: ['#ff3232'],
                    backgroundColor: ['#ff7f7f'],
                   
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        distribution: 'series',
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'Temperatura'
                        },
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                animation: {
                    duration: 0
                }
            }
        }
    );


    var paginacao = {};
    var tempo = {};
    
    function obterDados(grafico, endpoint) {
        var http = new XMLHttpRequest();
        http.open('GET', `http://localhost:3333/medidas/temperatura-umidade/${idContainer}`, false);
        http.send(null);
        var valores = JSON.parse(http.responseText);
        if (paginacao[endpoint] == null) {
            paginacao[endpoint] = 0;
        }
        if (tempo[endpoint] == null) {
            tempo[endpoint] = 0;
        }
        // Exibir à partir do último elemento exibido anteriormente
        var ultimaPaginacao = paginacao[endpoint];
        paginacao[endpoint] = valores.length;
        var valores = valores.slice(ultimaPaginacao);
        console.log(valores)
        valores.forEach((valor) => {
            //Máximo de 60 itens exibidos no gráfico
            if ( grafico.data.datasets[0].data.length == 10) {
                grafico.data.labels.shift();
                grafico.data.datasets[0].data.shift();
            }
            if(grafico == dht11Umidade){
              try {
                umidadeAtual = valor.umidade;
              } catch (error) {
                console.log(error)
              }
            }else{
              try {
                tempAtual = valor.temperatura  
              } catch (error) {
                console.log("Não pegou")
              }
              
            }
            console.log(valor)
            grafico.data.labels.push(valor.momento_grafico);
            if(grafico == dht11Temperatura){
              grafico.data.datasets[0].data.push(parseFloat(valor.temperatura));
            }else{
              grafico.data.datasets[0].data.push(parseFloat(valor.umidade));
            }
            
            grafico.update();
            
        })
        
    }

    
    

    setInterval(() => {
       obterDados(dht11Umidade, 'medidas/umidade');
       obterDados(dht11Temperatura, 'medidas/temperatura');
       atualizarStatus();
    }, 1000);

</script>

<script>
function tempo () {

    const data = new Date();
    let minuto = adicionarZero(data.getMinutes());
      
    let segundos = adicionarZero(data.getSeconds());

    let hora = adicionarZero(data.getHours());
    var tempo = hora+":"+minuto+":"+segundos;
      return tempo;
}


function adicionarZero(valor) {
  if (valor < 10){
     valor = "0" + valor;
  }
  return valor;
}
</script>

<script>

  function atualizarStatus(params) {
    var avisoUmidade = document.getElementById("p_umidade");
  var avisoTemperatura = document.getElementById("p_temperatura");

  if(tempAtual <= 10){
    avisoTemperatura.innerHTML = "Temperatura: <span class='status1'>Crítico Frio</span>" 
  }else if(tempAtual <= 11.64){
    avisoTemperatura.innerHTML = "Temperatura: <span class='status2'>Alerta Frio</span>" 
  }else if(tempAtual >= 11.65 && tempAtual <= 13.04){
    avisoTemperatura.innerHTML = "Temperatura: <span class='status3'>Ideal</span>" 
  }else if(tempAtual <  14){
    avisoTemperatura.innerHTML = "Temperatura: <span class='status4'>Alerta quente</span>"
  }else{
    avisoTemperatura.innerHTML = "Temperatura: <span class='status5'>Crítico quente</span>"
  }

  if(umidadeAtual <= 90){
    avisoUmidade.innerHTML ="Umidade: <span class='status1'>Crítica</span>" 
  }else if(umidadeAtual <= 90.45){
    avisoUmidade.innerHTML ="Umidade: <span class='status2'>Alerta</span>" 
  }else if(umidadeAtual >= 90.46 && umidadeAtual <= 91.33){
    avisoUmidade.innerHTML ="Umidade: <span class='status3'>Ideal</span>" 
  }else if(umidadeAtual <  95){
    avisoUmidade.innerHTML ="Umidade: <span class='status4'>Alerta</span>" 
  }else{
    avisoUmidade.innerHTML ="Umidade: <span class='status5'>Crítica</span>" 
  }
  }

 




</script>